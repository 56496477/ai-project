# Q宠物产品详细设计方案

## 1. 概述
本方案旨在复刻经典QQ宠物玩法，基于 React + TypeScript + PixiJS 技术栈，构建一个具备成长、互动、状态管理的网页版电子宠物应用。

## 2. 等级系统设计 (Level System)

### 2.1 基础设定
- **等级范围**: 1级 - 30级
- **经验机制**: 
  - 升级所需经验值：固定为 100 XP/级
  - 经验获取来源：喂食、清洁、打工、学习、互动等行为（具体数值见后续章节）

### 2.2 核心流程
1. **孵化阶段 (Level 0 -> Level 1)**
   - **初始状态**: 宠物为“蛋”形态。
   - **触发条件**: 用户需连续点击蛋体 **10次**。
   - **表现**: 
     - 点击过程中可播放蛋体晃动动画（需补充资源，若无则使用缩放效果）。
     - 满足条件后，播放 **破壳动画** (`resource/birth/1.swf`)。
     - 播放完毕后，宠物正式出生，等级变为 1级。

2. **升级流程**
   - 当当前经验值 >= 100 时触发升级。
   - **表现**: 
     - 扣除 100 经验值，等级 +1。
     - 播放 **升级特效动画** (`resource/upgrade/1.swf`)。
     - 升级后可能解锁新的物品或打工项目（预留扩展）。

## 3. 状态属性系统 (Status Attribute System)

宠物拥有5维核心属性，数值范围均为 0-100。属性变化会触发特定的状态机流转。

| 属性名称 | 范围 | 初始值 | 阈值设定 | 触发后果 | 关联动画资源 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **心情值** (Mood) | 0-100 | 80 | - | 影响宠物互动的频率和成功率 | (关联动作详见动画系统) |
| **清洁值** (Hygiene) | 0-100 | 100 | < 30 | 进入**脏污状态** | `resource/clean/2.swf` (痒/脏) |
| **学习值** (Intelligence) | 0-100 | 0 | - | 达到一定值解锁打工/技能 | (学习动作) |
| **饥饿值** (Hunger) | 0-100 | 80 | < 20 | 进入**饥饿状态** | `resource/eat/7.swf` (饿动画1) |
| **健康值** (Health) | 0-100 | 100 | < 40 | 进入**生病状态** | `resource/sick/1.swf` (冷/病) |

> **优先级说明**: 当多个状态同时满足阈值时，动画播放优先级为：
> **健康(生病) > 饥饿 > 清洁(脏) > 正常/随机**

### 3.1 状态衰减与疾病机制 (Health Decay & Sickness)
除了直接的数值变化外，系统包含基于时间的隐性衰减机制：
1. **饥饿致病**: 若**饥饿值 < 20** 持续超过 **3分钟**，健康值每分钟下降 **2点**。
2. **抑郁致病**: 若**心情值 < 20** 持续超过 **6分钟**，健康值每分钟下降 **1点**。
3. **死亡判定**: 当**健康值降为 0** 时，宠物死亡。
   - **表现**: 播放死亡动画 (`resource/dead/1.swf`)，随后变为静态墓碑 (`resource/dead/2.swf`)。
   - **复活**: 需消耗 **复活药水** (商店购买，极贵) 或 **重置存档** (清空所有等级/金币)。

## 4. 动画系统 (Animation System)

### 4.1 动画状态机
系统根据当前属性和用户操作决定播放的动画。

#### A. 默认状态 (Idle)
- **触发条件**: 无任何交互且属性正常。
- **动画**: 循环播放 **眨眼动画**。
- **资源**: `resource/daily/ok.swf`

#### B. 随机日常 (Random Idle)
- **触发条件**: 属性正常，每小时随机触发1次（或在Idle状态下随机概率触发）。
- **资源池** (从 resource/daily/ 中随机):
  - 挠背: `resource/daily/1.swf`
  - 往左下看: `resource/daily/2.swf` / `resource/daily/4.swf`
  - 往左上看: `resource/daily/3.swf` / `resource/daily/5.swf`
  - 玩耍: `resource/daily/6.swf`
  - 嘿嘿笑点头: `resource/daily/7.swf`
  - 撇嘴摇头: `resource/daily/8.swf`
  - 畏畏缩缩: `resource/daily/9.swf`
  - 亲你: `resource/daily/10.swf`
  - 伸手: `resource/daily/11.swf`
  - 无所谓: `resource/daily/12.swf`
  - 拎起来/落下: 仅在拖拽交互时触发 (`drag.swf`, `drop.swf` 等)

#### C. 异常状态 (Abnormal)
当属性低于阈值时，强制覆盖默认动画。

1. **生病 (Health < 40)**
   - **循环动画**: `resource/sick/1.swf` (冷/发抖)
2. **饥饿 (Hunger < 20)**
   - **循环动画**: `resource/eat/7.swf` (捂肚子/虚弱)
3. **脏污 (Hygiene < 30)**
   - **循环动画**: `resource/clean/2.swf` (挠痒)

## 5. 对话系统 (Speech System)

### 5.1 基础设定
- **UI组件**: 使用气泡对话框展示文字。
- **背景资源**: `resource/other/dialog.png`
- **显示位置**: 位于宠物头顶上方。
- **显示时长**: 默认 3-5 秒后自动消失。

### 5.2 触发机制与内容库
对话内容根据当前状态和触发事件动态选择。

| 触发类型 | 触发条件 | 内容示例 (文案需配置化) | 优先级 |
| :--- | :--- | :--- | :--- |
| **异常状态** | 进入饥饿/生病/脏污状态 | "主人，我肚子好饿..."<br>"哎哟，头好晕..."<br>"身上好痒呀！" | 高 |
| **互动反馈** | 用户点击宠物 | "干嘛戳我呀？"<br>"嘿嘿，好痒~"<br>"陪我玩一会嘛！" | 中 |
| **升级/成长** | 等级提升/破壳 | "哇！我变强了！"<br>"你好呀，新世界！" | 高 |
| **随机闲聊** | 默认状态下随机触发 | "今天天气真不错~"<br>"主人在干什么呢？" | 低 |

## 6. 互动与状态恢复 (Interaction & Recovery)

用户通过操作按钮触发特定行为，消耗金币或物品，恢复宠物属性并播放反馈动画。

### 5.1 恢复机制表

| 异常状态 | 恢复操作 | 效果 | 反馈动画 (播放1次) | 备注 |
| :--- | :--- | :--- | :--- | :--- |
| **饥饿** | **喂食 (Eat)** | 饥饿值 +N | 吃零食: `resource/eat/1.swf`<br>吃快餐: `resource/eat/2.swf`<br>吃大餐: `resource/eat/3.swf` | 根据食物等级选择动画 |
| | **喝水 (Drink)** | 饥饿/渴 +N | 喝水: `resource/eat/4.swf`<br>咖啡: `resource/eat/5.swf`<br>冷饮: `resource/eat/6.swf` | |
| **脏污** | **洗澡 (Clean)** | 清洁值 +100 | 洗澡: `resource/clean/1.swf` | 洗完后恢复 Idle 状态 |
| **生病** | **治疗 (Cure)** | 健康值 +100 | 打针: `resource/treatment/1.swf`<br>吃药: `resource/treatment/2.swf`<br>手术: `resource/treatment/3.swf` | 根据病情严重程度选择 |
| **心情低落** | **玩耍/抚摸** | 心情值 +N | 玩耍: `resource/daily/6.swf`<br>喝酒: `resource/sad/1.swf` (心情不好特有) | |
| **需提升学习**| **学习 (Study)** | 学习值 +N | 看书: `resource/study/1.swf` | 消耗精力/饥饿 |
| **需赚取金币**| **打工 (Work)** | 金币 +N | 送邮件: `resource/work/1.swf` | 消耗心情/饥饿 |

### 5.2 状态恢复逻辑
- 当用户执行恢复操作（如点击“喂食”）时：
  1. 立即暂停当前的异常状态动画（如饥饿动画）。
  2. 播放对应的操作反馈动画（如吃零食动画）。
  3. 后端/前端逻辑更新属性值（饥饿值增加）。
  4. 动画播放结束后，检查当前属性状态：
     - 若属性已恢复至阈值以上 -> 切换回 **默认状态 (Idle)** 或 **随机日常**。
     - 若属性仍低于阈值 -> 重新播放 **异常状态动画**。

## 7. 资源引用总表 (Resource Mapping)

该表对应项目 `README.md` 中的资源路径，确保程序加载正确。

### 核心系统
- **孵化**: `resource/birth/1.swf`
- **升级**: `resource/upgrade/1.swf`
- **死亡**: `resource/dead/1.swf` (动态), `resource/dead/2.swf` (静态)
- **默认/眨眼**: `resource/daily/ok.swf`

### 状态反馈
- **生病/冷**: `resource/sick/1.swf`
- **饥饿**: `resource/eat/7.swf`
- **脏/痒**: `resource/clean/2.swf`

### 交互动作
- **洗澡**: `resource/clean/1.swf`
- **学习**: `resource/study/1.swf`
- **打工**: `resource/work/1.swf`
- **心情调节(喝酒)**: `resource/sad/1.swf`

### 进食饮水
- **食物**: `resource/eat/1.swf` (零食), `resource/eat/2.swf` (快餐), `resource/eat/3.swf` (大餐)
- **饮料**: `resource/eat/4.swf` (水), `resource/eat/5.swf` (咖啡), `resource/eat/6.swf` (冷饮)

### 医疗
- **治疗**: `resource/treatment/1.swf` (打针), `resource/treatment/2.swf` (吃药), `resource/treatment/3.swf` (手术)

### 场景进出
- **出场**: `resource/exit/1.swf`, `resource/exit/2.swf`, `resource/exit/3.swf`
- **退场**: `resource/exit/4.swf`, `resource/exit/5.swf`
